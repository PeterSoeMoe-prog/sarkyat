(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,73884,97466,e=>{"use strict";var t=e.i(71645);e.i(51718);var r=e.i(18357),l=e.i(67426);e.i(36180);var o=e.i(98925);function n(e){return{id:e.id,thai:e.thai??"",burmese:e.burmese??null,count:Number.isFinite(Number(e.count))?Number(e.count):Number.isFinite(Number(e.hit))?Number(e.hit):0,status:e.status??"queue",category:e.category??null,updatedAt:function(e){if(!e)return 0;if("number"==typeof e&&Number.isFinite(e))return e;if(e instanceof Date)return e.getTime();if("function"==typeof e?.toMillis)try{let t=e.toMillis();return Number.isFinite(t)?t:0}catch{return 0}return"number"==typeof e?.seconds?Math.round(1e3*e.seconds+("number"==typeof e.nanoseconds?e.nanoseconds:0)/1e6):0}(e.updatedAt),ai_explanation:"string"==typeof e.ai_explanation?e.ai_explanation:null}}function a(e){return`users/${e}/vocab`}function i(e,t,r){let i=(0,l.getFirebaseDb)(),s=(0,o.collection)(i,a(e)),u=(0,o.query)(s,(0,o.orderBy)("updatedAt","desc"));return(0,o.onSnapshot)(u,{includeMetadataChanges:!0},e=>{t({items:e.docs.map(e=>e.data()).filter(e=>!!e&&"string"==typeof e.id).map(n),fromCache:e.metadata.fromCache})},e=>{r?.(e)})}async function s(e,t){let r=(0,l.getFirebaseDb)(),n=(0,o.doc)(r,a(e),t.id),i={...t,updatedAt:(0,o.serverTimestamp)()};await (0,o.setDoc)(n,i,{merge:!0})}async function u(e,t){let r=(0,l.getFirebaseDb)(),n=(0,o.doc)(r,"users",e);await (0,o.setDoc)(n,{...t,updatedAt:(0,o.serverTimestamp)()},{merge:!0})}async function d(e){let t=(0,l.getFirebaseDb)(),r=(0,o.doc)(t,"users",e),n=await (0,o.getDoc)(r);if(n.exists()){let e=n.data();return{dailyHitTarget:e.dailyHitTarget,studyStartDate:e.studyStartDate,googleAiApiKey:e.googleAiApiKey}}return null}async function c(e,t){let r=(0,l.getFirebaseDb)(),n=(0,o.doc)(r,a(e),t);await (0,o.deleteDoc)(n)}async function m(e,t){let r=(0,l.getFirebaseDb)(),i=(0,o.doc)(r,a(e),t),s=await (0,o.getDocFromServer)(i);return s.exists()?n(s.data()):null}async function x(e){let t=(0,l.getFirebaseDb)(),r=(0,o.collection)(t,a(e)),n=await (0,o.getDocs)(r);for(let e=0;e<n.docs.length;e+=450){let r=(0,o.writeBatch)(t);for(let t of n.docs.slice(e,e+450))r.delete(t.ref);await r.commit()}}async function b(e,t){let r=(0,l.getFirebaseDb)(),n=t.map(e=>({thai:(e.thai??"").trim(),burmese:(e.burmese??null)?.toString().trim()||null,category:(e.category??null)?.toString().trim()||null,count:Number.isFinite(Number(e.count))?Number(e.count):0,status:"drill"===String(e.status??"")||"ready"===String(e.status??"")?String(e.status):"queue"})).filter(e=>e.thai.length>0),i=null;for(let t=0;t<n.length;t+=450){let l=n.slice(t,t+450),s=(0,o.writeBatch)(r);for(let t of l){let l=globalThis.crypto?.randomUUID?.()??String(Date.now())+Math.random(),n=(0,o.doc)(r,a(e),String(l));i||(i=n.id),s.set(n,{id:n.id,thai:t.thai,burmese:t.burmese,count:t.count,status:t.status,category:t.category,updatedAt:(0,o.serverTimestamp)()},{merge:!0})}await s.commit()}return{importedCount:n.length,firstId:i}}function f(){let[e,o]=(0,t.useState)(null),[n,a]=(0,t.useState)(!1),[s,u]=(0,t.useState)(null),[d,c]=(0,t.useState)(null),[m,x]=(0,t.useState)(null),[b,f]=(0,t.useState)([]),[p,g]=(0,t.useState)(!0),[h,v]=(0,t.useState)(!0),[y,N]=(0,t.useState)(!0),[w,j]=(0,t.useState)(null);(0,t.useEffect)(()=>{if(!l.isFirebaseConfigured){o(null),f([]),g(!1),v(!0);return}let e=(0,l.getFirebaseAuth)();o(e.currentUser?.uid??null),a(e.currentUser?.isAnonymous??!1),u(e.currentUser?.email??null),c(e.currentUser?.displayName??null),x(e.currentUser?.photoURL??null);let t=(0,r.onAuthStateChanged)(e,e=>{o(e?.uid??null),a(e?.isAnonymous??!1),u(e?.email??null),c(e?.displayName??null),x(e?.photoURL??null)});return()=>t()},[]),(0,t.useEffect)(()=>{let e=()=>N(!0),t=()=>N(!1);return N(navigator.onLine),window.addEventListener("online",e),window.addEventListener("offline",t),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",t)}},[]),(0,t.useEffect)(()=>{if(!e||n){f([]),g(!1),v(!0),j(null);return}g(!0),j(null);try{let t=i(e,e=>{f(e.items),v(e.fromCache),g(!1)},e=>{j(`${e.code??"firestore-error"}: ${e.message??""}`.trim()),f([]),v(!0),g(!1)});return()=>t()}catch(e){j(e?.message?String(e.message):"Failed to start Firestore listener."),f([]),v(!0),g(!1);return}},[e,n]);let S=y?p||h?"syncing":"live":"offline",C=!!e&&!n&&"live"===S;return(0,t.useMemo)(()=>({uid:e,isAnonymous:n,email:s,displayName:d,photoURL:m,items:b,loading:p,isLive:C,status:S,vocabError:w}),[e,n,s,d,m,b,p,C,S,w])}e.s(["clearVocabulary",()=>x,"deleteVocabulary",()=>c,"fetchVocabularyEntryFromServer",()=>m,"getUserSettings",()=>d,"importVocabularyRows",()=>b,"listenVocabulary",()=>i,"saveUserSettings",()=>u,"upsertVocabulary",()=>s],97466),e.s(["useVocabulary",()=>f],73884)},78003,e=>{"use strict";var t=e.i(43476),r=e.i(22016),l=e.i(71645),o=e.i(46932),n=e.i(97466),a=e.i(73884);function i(e){return e.trim().toLowerCase().replaceAll("_"," ").replaceAll("-"," ").replaceAll(/\s+/g," ")}function s(e,t){let r=e.map(i),l=new Map;for(let e of(r.forEach((e,t)=>l.set(e,t)),t)){let t=l.get(i(e));if("number"==typeof t)return t}for(let e=0;e<r.length;e++){let l=r[e];if(t.some(e=>l.includes(i(e))))return e}return null}function u(){let{uid:e,isAnonymous:i}=(0,a.useVocabulary)(),[u,d]=(0,l.useState)(null),[c,m]=(0,l.useState)(null),[x,b]=(0,l.useState)(!0),[f,p]=(0,l.useState)(null),[g,h]=(0,l.useState)(null),[v,y]=(0,l.useState)(null),[N,w]=(0,l.useState)(null),[j,S]=(0,l.useState)(null),C=e=>{let t=e.trim().toLowerCase();return"drill"===t?"drill":"ready"===t?"ready":"queue"},[A,F]=(0,l.useState)(!1),[D,k]=(0,l.useState)(null),[V,T]=(0,l.useState)(null),U=(0,l.useMemo)(()=>{if(!c)return null;try{return function(e){let t=[],r=[],l="",o=!1,n=()=>{r.push(l),l=""},a=()=>{t.push(r),r=[]};for(let t=0;t<e.length;t++){let r=e[t];if(o){'"'===r?'"'===e[t+1]?(l+='"',t++):o=!1:l+=r;continue}if('"'===r){o=!0;continue}if(","===r){n();continue}if("\n"===r){n(),a();continue}if("\r"===r){"\n"===e[t+1]&&t++,n(),a();continue}l+=r}return o&&(o=!1),(l.length>0||r.length>0)&&(n(),a()),t.map(e=>e.map(e=>e.trim())).filter(e=>e.some(e=>e.length>0))}(c)}catch{return null}},[c]),$=(0,l.useMemo)(()=>U&&0!==U.length&&x?U[0]:null,[U,x]),M=(0,l.useMemo)(()=>U?x?U.slice(1):U:[],[U,x]),E=(0,l.useMemo)(()=>$?$.length:M.reduce((e,t)=>Math.max(e,t.length),0),[$,M]),I=(0,l.useMemo)(()=>{let e=[];for(let t=0;t<E;t++)e.push($?.[t]?.trim()||`Column ${t+1}`);return e},[E,$]),L=(0,l.useMemo)(()=>{if(!M.length)return[];let e=f??(x&&$?s($,["thai","thai word","word","term"]):0),t=g??(x&&$?s($,["burmese","meaning","burmese meaning","translation","myanmar"]):1),r=v??(x&&$?s($,["count","hit","hits","recite","recited"]):null),l=N??(x&&$?s($,["category","cat","group"]):null),o=j??(x&&$?s($,["status","state"]):null);return M.slice(0,8).map(n=>{let a=("number"==typeof e?n[e]:"")??"",i="number"==typeof t?n[t]??"":"",s="number"==typeof r?n[r]??"":"",u=Number.isFinite(Number(s))?Number(s):0,d=("number"==typeof l?n[l]??"":"").toString().trim(),c=C(("number"==typeof o?n[o]??"":"").toString());return{thai:a.trim(),burmese:i.trim(),count:u,category:d,status:c}}).filter(e=>e.thai.length>0)},[M,f,g,v,N,j,x,$]),B=async e=>{if(k(null),T(null),!e){d(null),m(null);return}d(e.name),m(await e.text()),p(null),h(null),y(null),w(null),S(null)},R=async()=>{if(k(null),T(null),!e||i)return void k("Sign in with Google first.");if(!U||0===U.length)return void k("No CSV loaded.");let t=x?U[0]:null,r=x?U.slice(1):U,l="number"==typeof f?f:t?s(t,["thai","thai word","word","term"])??0:0,o="number"==typeof g?g:t?s(t,["burmese","meaning","burmese meaning","translation","myanmar"])??1:1,a="number"==typeof v?v:t?s(t,["count","hit","hits","recite","recited"])??null:null;if("number"!=typeof a)return void k("Could not detect the CSV 'count' column. Please select the Count Column manually.");let u="number"==typeof N?N:t?s(t,["category","cat","group"])??null:null,d="number"==typeof j?j:t?s(t,["status","state"])??null:null,c=r.map(e=>{let t=(e[l]??"").trim(),r=(e[o]??"").trim(),n="number"==typeof a?e[a]??"":"",i=Number.isFinite(Number(n))?Number(n):0,s=("number"==typeof u?e[u]??"":"").toString().trim(),c=C(("number"==typeof d?e[d]??"":"").toString());return{thai:t,burmese:r.length?r:null,count:i,category:s.length?s:null,status:c}}).filter(e=>e.thai.length>0);if(0===c.length)return void k("No valid rows found (missing Thai words).");let m=c.filter(e=>Number(e.count??0)>0).length;if(c.length>=20&&0===m)return void k("All imported counts are 0. This usually means the Count Column is mapped to the wrong CSV column. Please select the Count Column manually and try again.");console.log("[import] resolved columns",{idxThai:l,idxBurmese:o,idxCount:a,idxCategory:u,idxStatus:d}),console.log("[import] first payload row",c[0]),F(!0);try{let t=await (0,n.importVocabularyRows)(e,c);console.log("[import] import result",t);let r=t?.firstId??null;if(!r)throw Error("Import completed but no document id was returned.");let l=await (0,n.fetchVocabularyEntryFromServer)(e,r);if(console.log("[import] first imported doc (server)",l),!l)throw Error("Import completed but verification read returned null.");let o=c[0];if(l.thai!==o.thai||l.count!==o.count||l.status!==o.status||(l.category??null)!==(o.category??null))throw Error(`Import verification failed. expected=${JSON.stringify(o)} actual=${JSON.stringify(l)}`);T(`Imported ${c.length} words.`)}catch(r){let e=r?.code?String(r.code):"unknown",t=r?.message?String(r.message):"Unknown error";k(`Import failed (${e}). ${t}`)}finally{F(!1)}},_=async()=>{if(k(null),T(null),!e||i)return void k("Sign in with Google first.");if(!U||0===U.length)return void k("No CSV loaded.");if(window.confirm("This will delete ALL existing words and re-import from the CSV. Continue?")){F(!0);try{await (0,n.clearVocabulary)(e),await R()}finally{F(!1)}}};return(0,t.jsx)("div",{className:"min-h-screen bg-[#0A0B0F] text-white",children:(0,t.jsx)("div",{className:"min-h-screen",style:{background:"radial-gradient(1200px 800px at 50% 10%, rgba(255,255,255,0.08), rgba(0,0,0,0) 55%), radial-gradient(900px 600px at 50% 60%, rgba(255,83,145,0.09), rgba(0,0,0,0) 60%), #0A0B0F"},children:(0,t.jsxs)("div",{className:"mx-auto w-full max-w-md px-4 pt-[calc(env(safe-area-inset-top)+20px)] pb-[calc(env(safe-area-inset-bottom)+118px)]",children:[(0,t.jsxs)("header",{className:"flex items-center justify-between",children:[(0,t.jsx)(r.default,{href:"/settings",className:"rounded-full bg-[var(--surface)]/80 px-4 py-2 text-[13px] font-semibold text-[color:var(--foreground)] backdrop-blur-xl shadow-sm hover:shadow-md transition-shadow border border-[color:var(--border)]",children:"Back"}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsx)("div",{className:"text-[17px] font-semibold tracking-[-0.01em]",children:"Import CSV"})}),(0,t.jsx)("div",{className:"w-[68px]"})]}),(0,t.jsxs)(o.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.18},className:"mt-5 rounded-2xl bg-[var(--card)] p-4 shadow-[0_10px_28px_rgba(0,0,0,0.20)] border border-[color:var(--border)] backdrop-blur-xl",children:[(0,t.jsx)("div",{className:"text-[15px] font-semibold",children:"Upload your CSV"}),(0,t.jsx)("div",{className:"mt-1 text-[13px] font-medium text-[color:var(--muted)]",children:"Columns will be mapped to Thai + Burmese."}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("input",{type:"file",accept:".csv,text/csv",onChange:e=>{B(e.target.files?.[0]??null)},className:"block w-full text-[13px] file:mr-4 file:rounded-full file:border file:border-[color:var(--border)] file:bg-[var(--surface)] file:px-4 file:py-2 file:text-[13px] file:font-semibold file:text-[color:var(--foreground)]"}),(0,t.jsx)("div",{className:"mt-2 text-[12px] font-medium text-[color:var(--muted)]",children:u||"No file selected"})]}),(0,t.jsxs)("div",{className:"mt-4 flex items-center justify-between rounded-xl bg-[var(--background)] px-3 py-2 border border-[color:var(--border)]",children:[(0,t.jsx)("div",{className:"text-[13px] font-semibold text-[color:var(--muted-strong)]",children:"First row is header"}),(0,t.jsx)("button",{type:"button",onClick:()=>b(e=>!e),className:"rounded-full bg-[var(--surface)] px-3 py-1.5 text-[12px] font-semibold text-[color:var(--foreground)] shadow-sm border border-[color:var(--border)]",children:x?"Yes":"No"})]}),U?(0,t.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[color:var(--muted)]",children:"Thai Column"}),(0,t.jsxs)("select",{value:f??"",onChange:e=>p(""===e.target.value?null:Number(e.target.value)),className:"mt-1 w-full rounded-xl bg-[var(--surface)] px-3 py-2 text-[13px] font-semibold border border-[color:var(--border)]",children:[(0,t.jsx)("option",{value:"",children:"Auto-detect"}),I.map((e,r)=>(0,t.jsx)("option",{value:r,children:e},`thai-${r}`))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[color:var(--muted)]",children:"Burmese Column"}),(0,t.jsxs)("select",{value:g??"",onChange:e=>h(""===e.target.value?null:Number(e.target.value)),className:"mt-1 w-full rounded-xl bg-[var(--surface)] px-3 py-2 text-[13px] font-semibold border border-[color:var(--border)]",children:[(0,t.jsx)("option",{value:"",children:"Auto-detect"}),I.map((e,r)=>(0,t.jsx)("option",{value:r,children:e},`burmese-${r}`))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[color:var(--muted)]",children:"Count Column"}),(0,t.jsxs)("select",{value:v??"",onChange:e=>y(""===e.target.value?null:Number(e.target.value)),className:"mt-1 w-full rounded-xl bg-[var(--surface)] px-3 py-2 text-[13px] font-semibold border border-[color:var(--border)]",children:[(0,t.jsx)("option",{value:"",children:"Auto-detect"}),I.map((e,r)=>(0,t.jsx)("option",{value:r,children:e},`count-${r}`))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[color:var(--muted)]",children:"Category Column"}),(0,t.jsxs)("select",{value:N??"",onChange:e=>w(""===e.target.value?null:Number(e.target.value)),className:"mt-1 w-full rounded-xl bg-[var(--surface)] px-3 py-2 text-[13px] font-semibold border border-[color:var(--border)]",children:[(0,t.jsx)("option",{value:"",children:"Auto-detect"}),I.map((e,r)=>(0,t.jsx)("option",{value:r,children:e},`cat-${r}`))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[color:var(--muted)]",children:"Status Column"}),(0,t.jsxs)("select",{value:j??"",onChange:e=>S(""===e.target.value?null:Number(e.target.value)),className:"mt-1 w-full rounded-xl bg-[var(--surface)] px-3 py-2 text-[13px] font-semibold border border-[color:var(--border)]",children:[(0,t.jsx)("option",{value:"",children:"Auto-detect"}),I.map((e,r)=>(0,t.jsx)("option",{value:r,children:e},`status-${r}`))]})]})]}),(0,t.jsxs)("div",{className:"rounded-xl bg-[var(--background)] p-3 border border-[color:var(--border)]",children:[(0,t.jsx)("div",{className:"text-[12px] font-semibold text-[color:var(--muted)]",children:"Preview"}),(0,t.jsx)("div",{className:"mt-2 space-y-2",children:L.length?L.map((e,r)=>(0,t.jsx)("div",{className:"rounded-xl bg-[var(--surface)] px-3 py-2 border border-[color:var(--border)]",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("div",{className:"text-[15px] font-semibold",children:e.thai}),e.burmese?(0,t.jsx)("div",{className:"mt-1 text-[13px] font-semibold text-[color:var(--muted-strong)]",children:e.burmese}):null,e.category?(0,t.jsxs)("div",{className:"mt-2 text-[11px] font-semibold text-[color:var(--muted)]",children:["Category: ",e.category]}):null]}),(0,t.jsxs)("div",{className:"shrink-0 text-right",children:[(0,t.jsx)("div",{className:"text-[16px] font-semibold tabular-nums",children:e.count}),(0,t.jsx)("div",{className:"text-[11px] font-semibold text-[color:var(--muted)]",children:"count"}),(0,t.jsx)("div",{className:"mt-2 text-[11px] font-semibold text-[color:var(--muted)]",children:e.status})]})]})},`preview-${r}`)):(0,t.jsx)("div",{className:"text-[13px] font-medium text-[color:var(--muted)]",children:"No preview rows yet."})})]})]}):null,D?(0,t.jsx)("div",{className:"mt-4 rounded-xl bg-red-500/10 p-3 text-[13px] font-semibold text-red-600 ring-1 ring-red-500/20",children:D}):null,V?(0,t.jsx)("div",{className:"mt-4 rounded-xl bg-green-500/10 p-3 text-[13px] font-semibold text-green-700 ring-1 ring-green-500/20",children:V}):null,(0,t.jsxs)("div",{className:"mt-4 flex gap-3",children:[(0,t.jsx)("button",{type:"button",onClick:R,disabled:!e||i||A||!U,className:"flex-1 rounded-xl bg-[color:var(--foreground)] px-4 py-3 text-[13px] font-semibold text-[color:var(--background)] shadow-sm hover:shadow-md transition-shadow disabled:opacity-40",children:A?"Importingâ€¦":"Import into Firestore"}),(0,t.jsx)("button",{type:"button",onClick:_,disabled:!e||i||A||!U,className:"rounded-xl bg-[var(--surface)]/70 px-4 py-3 text-[13px] font-semibold text-[color:var(--foreground)] border border-[color:var(--border)] backdrop-blur-xl shadow-sm hover:shadow-md transition-shadow disabled:opacity-40",children:"Clean & Re-import"})]}),!e||i?(0,t.jsx)("div",{className:"mt-3 text-[12px] font-medium text-[color:var(--muted)]",children:"Sign in required"}):(0,t.jsxs)("div",{className:"mt-3 break-all text-[12px] font-medium text-[color:var(--muted)]",children:["UID: ",e]})]}),(0,t.jsx)("div",{className:"mt-4 text-center text-[12px] font-medium text-[color:var(--muted)]",children:"After import, go back to Home to see your words."})]})})})}e.s(["default",()=>u])}]);